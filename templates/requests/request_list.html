{%  extends "smartmin/list.html" %}

{% block content %}
    {% load thumbnail %}
        <div class="span9 playlist-items">
            {% for r in object_list %}
                <div class="row playlist-item {% if r.track == now_playing.track %}playing{% endif %}">

                        <div class="track-cover">
                        {% if r.track.album.cover %}
                           {% thumbnail r.track.album.cover "350" crop="center" as im %}
                           <img src="{{ im.url }}" width="100%"/>
                           {% endthumbnail %}
                        {% else %}
                            <img src="{{ STATIC_URL }}/img/missing.png" width="100%"/>
                        {% endif %}
                        </div>

                        <div class="track-name">
                            {{ r.track.name }}
                        </div>

                        <div class="track-artist">
                          {% if r.track.album %}
                          <a href="{% url tracks.artist_read r.track.album.artist.id%}">{{ r.track.album.artist.name }}</a>
                          {% endif %}
                        </div>
                          {% if r.created_by.id != -1 %}
                              <div class="requested-by">
                              Requested by
                                  {% if r.created_by.first_name %}
                                      {{ r.created_by.first_name }}
                                  {% else %}
                                      {% if "android" in r.created_by.username %}
                                          SMS
                                      {% else %}
                                          {{ r.created_by.first_name }} {{ r.created_by.last_name }}
                                      {% endif %}

                                  {% endif %}

                                  {{ r.created_on|timesince }} ago
                              </div>
                      {% else %}

                      {% endif %}

                    {% if r.track == now_playing.track %}
                        <div class="now-playing">
                            <img src="{{ STATIC_URL }}img/now_playing_normal.gif"/>
                            <p>Now Playing</p>
                        </div>
                    {% endif %}

                </div>
            {% endfor %}

        </div>

  <div class="pagination">
    {% if page_obj.has_next or page_obj.number == 1 %}
    <a class="next" href="{{url_params|safe}}page={{page_obj.next_page_number}}">Next &rarr;</a>
    {% endif %}
  </div>

{% endblock %}

{% block extra-script %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.infinitescroll.min.js"></script>
<script>
  $(function(){
    $(".playlist-items").infinitescroll({
      navSelector  : "div.pagination",            
      nextSelector : "div.pagination a.next",    
      itemSelector : "div.playlist-item",
      bufferPx     : 100,
      donetext     : "No more requests.",
      loadingText  : "Loading more requests..."
    });
  });
</script>
{% endblock %}

{% block footer %}
{% endblock %}
